<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jinwoo's Story</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 텍스트 그림자 (가독성 향상) */
        .shadow-text {
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        /* 스켈레톤 로딩 애니메이션 */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-400 via-blue-300 to-cyan-400 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 1. 금융 상품 설정 (사용자 요청 목록)
        const FINANCIAL_SYMBOLS = [
            { symbol: 'BTC-USD', name: '비트코인', icon: '₿' },
            { symbol: '^IXIC', name: '나스닥', icon: '📊' },
            { symbol: '^GSPC', name: 'S&P 500', icon: '📈' },
            { symbol: '^N225', name: '니케이225', icon: '🗾' },
            { symbol: '^HSI', name: '항셍지수', icon: '🇭🇰' },
            { symbol: '^KS11', name: '코스피', icon: '🇰🇷' },
            { symbol: '^KQ11', name: '코스닥', icon: '📱' },
            { symbol: 'GC=F', name: '금', icon: '🥇' },
            { symbol: 'CL=F', name: 'WTI 원유', icon: '🛢️' },
            { symbol: 'NG=F', name: '천연가스', icon: '🔥' },
            { symbol: '^STOXX50E', name: '유로스탁스50', icon: '🇪🇺' }
        ];

        // 2. 금융 데이터 카드 컴포넌트
        function QuoteCard({ item, data }) {
            const price = data.regularMarketPrice || 0;
            const change = data.regularMarketChange || 0;
            const changePercent = data.regularMarketChangePercent || 0;
            
            const changeColor = change >= 0 ? 'text-green-600' : 'text-red-600';
            const changeIcon = change >= 0 ? 'fa-caret-up' : 'fa-caret-down';

            return (
                <div className="bg-white/80 backdrop-blur-sm p-5 rounded-xl shadow-lg transition-all duration-300 transform hover:shadow-2xl hover:-translate-y-1">
                    <div className="flex justify-between items-center mb-2">
                        <div className="flex items-center space-x-3">
                            <span className="text-3xl">{item.icon}</span>
                            <span className="font-bold text-lg text-gray-800">{item.name}</span>
                        </div>
                        <span className="text-sm font-mono text-gray-500">{data.symbol}</span>
                    </div>
                    <div className="text-right">
                        <h3 className="text-3xl font-bold text-gray-900 mb-1">
                            {price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </h3>
                        <div className={`flex items-center justify-end font-semibold ${changeColor}`}>
                            <i className={`fas ${changeIcon} mr-1`}></i>
                            <span>{change.toFixed(2)}</span>
                            <span className="ml-2">({changePercent.toFixed(2)}%)</span>
                        </div>
                    </div>
                </div>
            );
        }

        // 3. 로딩 스켈레톤 카드 컴포넌트
        function QuoteCardSkeleton() {
            return (
                <div className="bg-white/50 backdrop-blur-sm p-5 rounded-xl shadow-lg animate-pulse">
                    <div className="flex justify-between items-center mb-2">
                        <div className="h-8 w-32 bg-gray-300 rounded"></div>
                        <div className="h-4 w-16 bg-gray-300 rounded"></div>
                    </div>
                    <div className="text-right">
                        <div className="h-9 w-40 bg-gray-300 rounded mb-1 ml-auto"></div>
                        <div className="h-6 w-32 bg-gray-300 rounded ml-auto"></div>
                    </div>
                </div>
            );
        }

        // 4. 메인 대시보드 컴포넌트
        function PortfolioDashboard() {
            const [quotes, setQuotes] = useState({});
            const [loading, setLoading] = useState(true);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [errors, setErrors] = useState(null);

            // 링크 정보 (사용자 코드)
            const links = [
                { name: '티스토리 블로그', url: 'https://hanglestocks.tistory.com', icon: 'fa-t', customIcon: true, color: 'from-orange-500 to-red-500' },
                { name: 'Threads', url: 'https://www.threads.com/@sgfindreamer?hl=ko', icon: 'fa-at', customIcon: false, color: 'from-purple-500 to-pink-500' },
                { name: 'LinkedIn', url: 'https://www.linkedin.com/in/heyjinwoo', icon: 'fa-linkedin', customIcon: false, color: 'from-blue-600 to-blue-700' },
                { name: 'GitHub', url: 'https://github.com/superjin1218', icon: 'fa-github', customIcon: false, color: 'from-gray-700 to-gray-900' }
            ];

            // 데이터 패치 함수
            const fetchData = async () => {
                if (Object.keys(quotes).length === 0) {
                    setLoading(true); // 첫 로드 시에만 전체 로딩
                }
                setErrors(null);

                const symbolsString = FINANCIAL_SYMBOLS.map(s => s.symbol).join(',');
                
                // 야후 파이낸스 API (비공식)
                const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbolsString}`;
                // CORS 우회 프록시
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

                try {
                    const response = await fetch(proxyUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    if (data.quoteResponse && data.quoteResponse.result) {
                        // 데이터를 { 'BTC-USD': {...}, '^IXIC': {...} } 형태의 맵으로 변환
                        const quotesMap = data.quoteResponse.result.reduce((acc, quote) => {
                            acc[quote.symbol] = quote;
                            return acc;
                        }, {});
                        setQuotes(quotesMap);
                        setLastUpdate(new Date());
                    } else {
                        throw new Error('API 응답 형식이 올바르지 않습니다.');
                    }
                } catch (error) {
                    console.error("Fetching error: ", error);
                    setErrors(`데이터를 불러오는 데 실패했습니다: ${error.message}.`);
                } finally {
                    setLoading(false);
                }
            };

            // 1분마다 데이터 갱신
            useEffect(() => {
                fetchData(); // 컴포넌트 마운트 시 즉시 실행
                const intervalId = setInterval(fetchData, 60000); // 1분 (60 * 1000 ms)

                // 컴포넌트 언마운트 시 인터벌 정리
                return () => clearInterval(intervalId);
            }, []);

            const isLoadingFirstTime = loading && Object.keys(quotes).length === 0;

            return (
                <div className="container mx-auto p-4 md:p-8 max-w-7xl">
                    {/* --- 1. 헤더 --- */}
                    <h1 className="text-4xl md:text-5xl font-bold text-white text-center mb-8 shadow-text">
                        Jinwoo's Story
                    </h1>
                    
                    {/* --- 2. 금융 대시보드 섹션 --- */}
                    <div className="mb-12">
                        <h2 className="text-3xl font-bold text-gray-800 mb-2 flex items-center">
                            <i className="fas fa-chart-line mr-3"></i>
                            실시간 금융 대시보드
                        </h2>
                        
                        {/* 마지막 업데이트 시간 및 참고 문구 */}
                        <div className="flex justify-between items-center mb-4 text-sm text-gray-700">
                            <span>
                                {lastUpdate ? `마지막 업데이트: ${lastUpdate.toLocaleTimeString('ko-KR')}` : '데이터 로드 중...'}
                            </span>
                            <span className="italic">
                                * 1분 지연 데이터 (Yahoo Finance 제공)
                            </span>
                        </div>
                        
                        {/* 에러 메시지 */}
                        {errors && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4" role="alert">
                                <strong className="font-bold">오류! </strong>
                                <span className="block sm:inline">{errors}</span>
                            </div>
                        )}

                        {/* 금융 상품 카드 그리드 */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {isLoadingFirstTime 
                                ? (
                                    // 첫 로딩 시 스켈레톤 UI
                                    FINANCIAL_SYMBOLS.map(item => <QuoteCardSkeleton key={item.symbol} />)
                                ) : (
                                    // 데이터가 있거나 갱신 중일 때
                                    FINANCIAL_SYMBOLS.map(item => {
                                        const data = quotes[item.symbol];
                                        // 데이터가 있으면 카드, 없으면 스켈레톤 (갱신 중 누락 방지)
                                        return data 
                                            ? <QuoteCard key={item.symbol} item={item} data={data} />
                                            : <QuoteCardSkeleton key={item.symbol} />;
                                    })
                                )
                            }
                        </div>
                    </div>


                    {/* --- 3. 소셜 링크 섹션 (사용자 코드) --- */}
                    <div className="mb-12">
                        <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-link mr-3"></i>
                            내 링크
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            {links.map((link, index) => (
                                <a
                                    key={index}
                                    href={link.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className={`bg-gradient-to-br ${link.color} p-6 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1`}
                                >
                                    <div className="flex items-center space-x-4">
                                        {link.customIcon ? (
                                            <div className="text-3xl text-white font-black" style={{fontFamily: 'Arial, sans-serif'}}>
                                                tistory
                                            </div>
                                        ) : (
                                            <i className={`fab ${link.icon} text-3xl text-white`}></i>
                                        )}
                                        <div>
                                            <h3 className="text-white font-bold text-lg">{link.name}</h3>
                                            <p className="text-white text-sm opacity-80">방문하기</p>
                                        </div>
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // 5. React 앱을 DOM에 렌더링
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PortfolioDashboard />);
    </script>
</body>
</html>
