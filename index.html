<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jinwoo's Story</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* í…ìŠ¤íŠ¸ ê·¸ë¦¼ì (ê°€ë…ì„± í–¥ìƒ) */
        .shadow-text {
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        /* ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-400 via-blue-300 to-cyan-400 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 1. ê¸ˆìœµ ìƒí’ˆ ì„¤ì • (ì‚¬ìš©ì ìš”ì²­ ëª©ë¡)
        const FINANCIAL_SYMBOLS = [
            { symbol: 'BTC-USD', name: 'ë¹„íŠ¸ì½”ì¸', icon: 'â‚¿' },
            { symbol: '^IXIC', name: 'ë‚˜ìŠ¤ë‹¥', icon: 'ğŸ“Š' },
            { symbol: '^GSPC', name: 'S&P 500', icon: 'ğŸ“ˆ' },
            { symbol: '^N225', name: 'ë‹ˆì¼€ì´225', icon: 'ğŸ—¾' },
            { symbol: '^HSI', name: 'í•­ì…ì§€ìˆ˜', icon: 'ğŸ‡­ğŸ‡°' },
            { symbol: '^KS11', name: 'ì½”ìŠ¤í”¼', icon: 'ğŸ‡°ğŸ‡·' },
            { symbol: '^KQ11', name: 'ì½”ìŠ¤ë‹¥', icon: 'ğŸ“±' },
            { symbol: 'GC=F', name: 'ê¸ˆ', icon: 'ğŸ¥‡' },
            { symbol: 'CL=F', name: 'WTI ì›ìœ ', icon: 'ğŸ›¢ï¸' },
            { symbol: 'NG=F', name: 'ì²œì—°ê°€ìŠ¤', icon: 'ğŸ”¥' },
            { symbol: '^STOXX50E', name: 'ìœ ë¡œìŠ¤íƒìŠ¤50', icon: 'ğŸ‡ªğŸ‡º' }
        ];

        // 2. ê¸ˆìœµ ë°ì´í„° ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
        function QuoteCard({ item, data }) {
            const price = data.regularMarketPrice || 0;
            const change = data.regularMarketChange || 0;
            const changePercent = data.regularMarketChangePercent || 0;
            
            const changeColor = change >= 0 ? 'text-green-600' : 'text-red-600';
            const changeIcon = change >= 0 ? 'fa-caret-up' : 'fa-caret-down';

            return (
                <div className="bg-white/80 backdrop-blur-sm p-5 rounded-xl shadow-lg transition-all duration-300 transform hover:shadow-2xl hover:-translate-y-1">
                    <div className="flex justify-between items-center mb-2">
                        <div className="flex items-center space-x-3">
                            <span className="text-3xl">{item.icon}</span>
                            <span className="font-bold text-lg text-gray-800">{item.name}</span>
                        </div>
                        <span className="text-sm font-mono text-gray-500">{data.symbol}</span>
                    </div>
                    <div className="text-right">
                        <h3 className="text-3xl font-bold text-gray-900 mb-1">
                            {price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </h3>
                        <div className={`flex items-center justify-end font-semibold ${changeColor}`}>
                            <i className={`fas ${changeIcon} mr-1`}></i>
                            <span>{change.toFixed(2)}</span>
                            <span className="ml-2">({changePercent.toFixed(2)}%)</span>
                        </div>
                    </div>
                </div>
            );
        }

        // 3. ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
        function QuoteCardSkeleton() {
            return (
                <div className="bg-white/50 backdrop-blur-sm p-5 rounded-xl shadow-lg animate-pulse">
                    <div className="flex justify-between items-center mb-2">
                        <div className="h-8 w-32 bg-gray-300 rounded"></div>
                        <div className="h-4 w-16 bg-gray-300 rounded"></div>
                    </div>
                    <div className="text-right">
                        <div className="h-9 w-40 bg-gray-300 rounded mb-1 ml-auto"></div>
                        <div className="h-6 w-32 bg-gray-300 rounded ml-auto"></div>
                    </div>
                </div>
            );
        }

        // 4. ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
        function PortfolioDashboard() {
            const [quotes, setQuotes] = useState({});
            const [loading, setLoading] = useState(true);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [errors, setErrors] = useState(null);

            // ë§í¬ ì •ë³´ (ì‚¬ìš©ì ì½”ë“œ)
            const links = [
                { name: 'í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸', url: 'https://hanglestocks.tistory.com', icon: 'fa-t', customIcon: true, color: 'from-orange-500 to-red-500' },
                { name: 'Threads', url: 'https://www.threads.com/@sgfindreamer?hl=ko', icon: 'fa-at', customIcon: false, color: 'from-purple-500 to-pink-500' },
                { name: 'LinkedIn', url: 'https://www.linkedin.com/in/heyjinwoo', icon: 'fa-linkedin', customIcon: false, color: 'from-blue-600 to-blue-700' },
                { name: 'GitHub', url: 'https://github.com/superjin1218', icon: 'fa-github', customIcon: false, color: 'from-gray-700 to-gray-900' }
            ];

            // ë°ì´í„° íŒ¨ì¹˜ í•¨ìˆ˜
            const fetchData = async () => {
                if (Object.keys(quotes).length === 0) {
                    setLoading(true); // ì²« ë¡œë“œ ì‹œì—ë§Œ ì „ì²´ ë¡œë”©
                }
                setErrors(null);

                const symbolsString = FINANCIAL_SYMBOLS.map(s => s.symbol).join(',');
                
                // ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ API (ë¹„ê³µì‹)
                const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbolsString}`;
                // CORS ìš°íšŒ í”„ë¡ì‹œ
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

                try {
                    const response = await fetch(proxyUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    if (data.quoteResponse && data.quoteResponse.result) {
                        // ë°ì´í„°ë¥¼ { 'BTC-USD': {...}, '^IXIC': {...} } í˜•íƒœì˜ ë§µìœ¼ë¡œ ë³€í™˜
                        const quotesMap = data.quoteResponse.result.reduce((acc, quote) => {
                            acc[quote.symbol] = quote;
                            return acc;
                        }, {});
                        setQuotes(quotesMap);
                        setLastUpdate(new Date());
                    } else {
                        throw new Error('API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error("Fetching error: ", error);
                    setErrors(`ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}.`);
                } finally {
                    setLoading(false);
                }
            };

            // 1ë¶„ë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
            useEffect(() => {
                fetchData(); // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì¦‰ì‹œ ì‹¤í–‰
                const intervalId = setInterval(fetchData, 60000); // 1ë¶„ (60 * 1000 ms)

                // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì¸í„°ë²Œ ì •ë¦¬
                return () => clearInterval(intervalId);
            }, []);

            const isLoadingFirstTime = loading && Object.keys(quotes).length === 0;

            return (
                <div className="container mx-auto p-4 md:p-8 max-w-7xl">
                    {/* --- 1. í—¤ë” --- */}
                    <h1 className="text-4xl md:text-5xl font-bold text-white text-center mb-8 shadow-text">
                        Jinwoo's Story
                    </h1>
                    
                    {/* --- 2. ê¸ˆìœµ ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ --- */}
                    <div className="mb-12">
                        <h2 className="text-3xl font-bold text-gray-800 mb-2 flex items-center">
                            <i className="fas fa-chart-line mr-3"></i>
                            ì‹¤ì‹œê°„ ê¸ˆìœµ ëŒ€ì‹œë³´ë“œ
                        </h2>
                        
                        {/* ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ë° ì°¸ê³  ë¬¸êµ¬ */}
                        <div className="flex justify-between items-center mb-4 text-sm text-gray-700">
                            <span>
                                {lastUpdate ? `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${lastUpdate.toLocaleTimeString('ko-KR')}` : 'ë°ì´í„° ë¡œë“œ ì¤‘...'}
                            </span>
                            <span className="italic">
                                * 1ë¶„ ì§€ì—° ë°ì´í„° (Yahoo Finance ì œê³µ)
                            </span>
                        </div>
                        
                        {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
                        {errors && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4" role="alert">
                                <strong className="font-bold">ì˜¤ë¥˜! </strong>
                                <span className="block sm:inline">{errors}</span>
                            </div>
                        )}

                        {/* ê¸ˆìœµ ìƒí’ˆ ì¹´ë“œ ê·¸ë¦¬ë“œ */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {isLoadingFirstTime 
                                ? (
                                    // ì²« ë¡œë”© ì‹œ ìŠ¤ì¼ˆë ˆí†¤ UI
                                    FINANCIAL_SYMBOLS.map(item => <QuoteCardSkeleton key={item.symbol} />)
                                ) : (
                                    // ë°ì´í„°ê°€ ìˆê±°ë‚˜ ê°±ì‹  ì¤‘ì¼ ë•Œ
                                    FINANCIAL_SYMBOLS.map(item => {
                                        const data = quotes[item.symbol];
                                        // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¹´ë“œ, ì—†ìœ¼ë©´ ìŠ¤ì¼ˆë ˆí†¤ (ê°±ì‹  ì¤‘ ëˆ„ë½ ë°©ì§€)
                                        return data 
                                            ? <QuoteCard key={item.symbol} item={item} data={data} />
                                            : <QuoteCardSkeleton key={item.symbol} />;
                                    })
                                )
                            }
                        </div>
                    </div>


                    {/* --- 3. ì†Œì…œ ë§í¬ ì„¹ì…˜ (ì‚¬ìš©ì ì½”ë“œ) --- */}
                    <div className="mb-12">
                        <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-link mr-3"></i>
                            ë‚´ ë§í¬
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            {links.map((link, index) => (
                                <a
                                    key={index}
                                    href={link.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className={`bg-gradient-to-br ${link.color} p-6 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1`}
                                >
                                    <div className="flex items-center space-x-4">
                                        {link.customIcon ? (
                                            <div className="text-3xl text-white font-black" style={{fontFamily: 'Arial, sans-serif'}}>
                                                tistory
                                            </div>
                                        ) : (
                                            <i className={`fab ${link.icon} text-3xl text-white`}></i>
                                        )}
                                        <div>
                                            <h3 className="text-white font-bold text-lg">{link.name}</h3>
                                            <p className="text-white text-sm opacity-80">ë°©ë¬¸í•˜ê¸°</p>
                                        </div>
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // 5. React ì•±ì„ DOMì— ë Œë”ë§
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PortfolioDashboard />);
    </script>
</body>
</html>
